{"metadata":{"guid":"09197fda-ac62-42ec-a52e-a03daf91e05f","url":"/v2/streaming_pipelines/09197fda-ac62-42ec-a52e-a03daf91e05f","created_at":"2017-12-21T15:04:14Z","updated_at":"2018-01-11T22:03:23Z","revision":1515708203541},"entity":{"name":"Aggregation examples","description":"See examples of how to use the Aggregation operator with real time data.  The examples compute different sales statistics for an online store.","project_guid":"e063a60f-efd2-4106-95a3-9efb18692908","graph":{"doc_type":"pipeline","version":"1.0","json_schema":"http://www.ibm.com/ibm/wdp/flow-v1.0/pipeline-flow-v1-schema.json","id":"","app_data":{"ui_data":{"name":"Aggregation examples"}},"primary_pipeline":"primary-pipeline","pipelines":[{"id":"primary-pipeline","runtime":"streams","nodes":[{"id":"node0","type":"binding","op":"ibm.streams.sources.messagehubsample","outputs":[{"id":"target","schema_ref":"schema0","links":[{"node_id_ref":"aggregate_j7jx0i0j45","port_id_ref":"source"},{"node_id_ref":"freeform_filter_ulfnr641idl","port_id_ref":"source"},{"node_id_ref":"freeform_filter_x5gevoh2cm","port_id_ref":"source"}]}],"parameters":{"schema_mapping":[{"name":"customer_id","type":"double","path":"/customer_id"},{"name":"time_stamp","type":"timestamp","path":"/time_stamp"},{"name":"click_event_type","type":"string","length":255,"path":"/click_event_type"},{"name":"total_price_of_basket","type":"double","path":"/total_price_of_basket"},{"name":"total_number_of_items_in_basket","type":"double","path":"/total_number_of_items_in_basket"},{"name":"total_number_of_distinct_items_in_basket","type":"double","path":"/total_number_of_distinct_items_in_basket"},{"name":"product_name","type":"string","length":255,"path":"/product_name"},{"name":"product_category","type":"string","length":255,"path":"/product_category"},{"name":"product_price","type":"double","path":"/product_price"}]},"connection":{"ref":"EXAMPLE_MESSAGE_HUB_CONNECTION","project_ref":"EXAMPLE","properties":{"asset":{"path":"/clickStreamSampleData","type":"topic","name":"Clickstream","id":"clickStreamSampleData"}}},"app_data":{"ui_data":{"label":"Sample Data","x_pos":-800,"y_pos":100}}},{"id":"aggregate_j7jx0i0j45","type":"execution_node","op":"ibm.streams.operations.aggregate","outputs":[{"id":"target","schema_ref":"schema1","links":[{"node_id_ref":"objectstorage_v2_uagt88ddj8","port_id_ref":"source"}]}],"parameters":{"window_time_unit":"minute","window_number_of_time_units":"1","use_timestamp_in_tuple":true,"timestamp_field":"time_stamp","aggregation_output":[{"name":"time_stamp","value":{"function":"Any","type":"timestamp","arguments":["time_stamp"]},"type":""},{"name":"total_customers_per_hr","value":{"function":"CountDistinct","type":"double","arguments":["customer_id"]},"type":""}],"schema_mapping":[{"name":"time_stamp","type":"timestamp"},{"name":"total_customers_per_hr","type":"integer"}]},"app_data":{"ui_data":{"label":"Customers_per_hr","x_pos":-418,"y_pos":237}}},{"id":"objectstorage_v2_uagt88ddj8","type":"binding","op":"ibm.streams.targets.objectstorage_v2","parameters":{"header_row_enabled":true,"write_policy":"numberOfEvents","rolling_number_of_events":"10"},"connection":{"ref":"48f9e5ff-31cd-483c-8f41-83e5aa885037","project_ref":"e063a60f-efd2-4106-95a3-9efb18692908","properties":{"asset":{"path":"/aggregatedemo/customers_per_hr.csv","asset_types":[],"assets":[],"fields":[],"extended_metadata":[],"first":{"href":"https://api.dataplatform.ibm.com/v2/connections/48f9e5ff-31cd-483c-8f41-83e5aa885037/assets?project_id=e063a60f-efd2-4106-95a3-9efb18692908&offset=0&limit=100&path=%2Faggregatedemo%2Fcustomers_per_hr.csv"},"total_count":0,"logs":[]}}},"app_data":{"ui_data":{"label":"Cloud Object Storage","x_pos":-113,"y_pos":240}}},{"id":"freeform_filter_ulfnr641idl","type":"execution_node","op":"ibm.streams.operations.freeform-filter","outputs":[{"id":"target","schema_ref":"schema2","links":[{"node_id_ref":"aggregate_b43vwk5ixzl","port_id_ref":"source"}]}],"parameters":{"expression":"click_event_type == \"checkout\""},"app_data":{"ui_data":{"label":"Filter","x_pos":-418,"y_pos":346}}},{"id":"aggregate_b43vwk5ixzl","type":"execution_node","op":"ibm.streams.operations.aggregate","outputs":[{"id":"target","schema_ref":"schema3","links":[{"node_id_ref":"objectstorage_v2_24m7dwvx131i","port_id_ref":"source"}]}],"parameters":{"window_type":"sliding","window_time_unit":"minute","window_number_of_time_units":"5","use_timestamp_in_tuple":true,"timestamp_field":"time_stamp","aggregation_output":[{"name":"time_stamp","value":{"function":"Any","type":"timestamp","arguments":["time_stamp"]},"type":""},{"name":"total_sales_last_5min","value":{"function":"Sum","type":"double","arguments":["total_price_of_basket"]},"type":""}],"schema_mapping":[{"name":"time_stamp","type":"timestamp"},{"name":"total_sales_last_5min","type":"double"}]},"app_data":{"ui_data":{"label":"Total sales in the last 5 min","x_pos":-208,"y_pos":346}}},{"id":"objectstorage_v2_24m7dwvx131i","type":"binding","op":"ibm.streams.targets.objectstorage_v2","parameters":{"header_row_enabled":true,"write_policy":"numberOfEvents","rolling_number_of_events":"100"},"connection":{"ref":"48f9e5ff-31cd-483c-8f41-83e5aa885037","project_ref":"e063a60f-efd2-4106-95a3-9efb18692908","properties":{"asset":{"id":"/aggregatedemo/TotalSales.csv","name":"/aggregatedemo/TotalSales.csv","path":"/aggregatedemo/TotalSales.csv","type":"unknown"}}},"app_data":{"ui_data":{"label":"Cloud Object Storage","x_pos":2,"y_pos":356}}},{"id":"freeform_filter_x5gevoh2cm","type":"execution_node","op":"ibm.streams.operations.freeform-filter","outputs":[{"id":"target","schema_ref":"schema4","links":[{"node_id_ref":"aggregate_d9vaq0wewck","port_id_ref":"source"},{"node_id_ref":"aggregate_4rczrp61il4","port_id_ref":"source"},{"node_id_ref":"aggregate_bj1doqn92ze","port_id_ref":"source"}]}],"parameters":{"expression":"product_price > 0"},"app_data":{"ui_data":{"label":"Filter","x_pos":-605,"y_pos":-95}}},{"id":"aggregate_d9vaq0wewck","type":"execution_node","op":"ibm.streams.operations.aggregate","outputs":[{"id":"target","schema_ref":"schema5","links":[{"node_id_ref":"objectstorage_v2_v7at62471dn","port_id_ref":"source"}]}],"parameters":{"window_type":"sliding","window_time_unit":"minute","window_number_of_time_units":"30","use_timestamp_in_tuple":true,"timestamp_field":"time_stamp","partition_by":"product_category","aggregation_output":[{"name":"time_stamp","value":{"function":"Any","type":"timestamp","arguments":["time_stamp"]},"type":""},{"name":"product_category","value":{"function":"Any","type":"varchar","arguments":["product_category"]},"type":""},{"name":"total_sales_last_30min","value":{"function":"Sum","type":"double","arguments":["product_price"]},"type":""}],"schema_mapping":[{"name":"time_stamp","type":"timestamp"},{"name":"product_category","type":"string"},{"name":"total_sales_last_30min","type":"double"}]},"app_data":{"ui_data":{"label":"30min_dept_sales","x_pos":-333,"y_pos":-188}}},{"id":"objectstorage_v2_v7at62471dn","type":"binding","op":"ibm.streams.targets.objectstorage_v2","parameters":{"header_row_enabled":true,"write_policy":"numberOfEvents","rolling_number_of_events":"100"},"connection":{"ref":"48f9e5ff-31cd-483c-8f41-83e5aa885037","project_ref":"e063a60f-efd2-4106-95a3-9efb18692908","properties":{"asset":{"path":"/aggregatedemo/30min_dept_sales.csv","asset_types":[],"assets":[],"fields":[],"extended_metadata":[],"first":{"href":"https://api.dataplatform.ibm.com/v2/connections/48f9e5ff-31cd-483c-8f41-83e5aa885037/assets?project_id=e063a60f-efd2-4106-95a3-9efb18692908&offset=0&limit=100&path=%2Faggregatedemo%2F30min_dept_sales.csv"},"total_count":0,"logs":[]}}},"app_data":{"ui_data":{"label":"Cloud Object Storage","x_pos":-73,"y_pos":-188}}},{"id":"aggregate_4rczrp61il4","type":"execution_node","op":"ibm.streams.operations.aggregate","outputs":[{"id":"target","schema_ref":"schema6","links":[{"node_id_ref":"objectstorage_v2_g50do6drk9r","port_id_ref":"source"}]}],"parameters":{"window_type":"sliding","window_time_unit":"minute","window_number_of_time_units":"10","use_timestamp_in_tuple":true,"timestamp_field":"time_stamp","partition_by":"product_category","aggregation_output":[{"name":"time_stamp","value":{"function":"Any","type":"timestamp","arguments":["time_stamp"]},"type":""},{"name":"product_category","value":{"function":"Any","type":"varchar","arguments":["product_category"]},"type":""},{"name":"total_sales_last_10min","value":{"function":"Sum","type":"double","arguments":["product_price"]},"type":""}],"schema_mapping":[{"name":"time_stamp","type":"timestamp"},{"name":"product_category","type":"string"},{"name":"total_sales_last_10min","type":"double"}]},"app_data":{"ui_data":{"label":"10min_dept_sales","x_pos":-333,"y_pos":-88}}},{"id":"objectstorage_v2_g50do6drk9r","type":"binding","op":"ibm.streams.targets.objectstorage_v2","parameters":{"header_row_enabled":true,"write_policy":"numberOfEvents","rolling_number_of_events":"100"},"connection":{"ref":"48f9e5ff-31cd-483c-8f41-83e5aa885037","project_ref":"e063a60f-efd2-4106-95a3-9efb18692908","properties":{"asset":{"path":"/aggregatedemo/10min_dept_sales.csv","asset_types":[],"assets":[],"fields":[],"extended_metadata":[],"first":{"href":"https://api.dataplatform.ibm.com/v2/connections/48f9e5ff-31cd-483c-8f41-83e5aa885037/assets?project_id=e063a60f-efd2-4106-95a3-9efb18692908&offset=0&limit=100&path=%2Faggregatedemo%2F10min_dept_sales.csv"},"total_count":0,"logs":[]}}},"app_data":{"ui_data":{"label":"Cloud Object Storage","x_pos":-83,"y_pos":-88}}},{"id":"aggregate_bj1doqn92ze","type":"execution_node","op":"ibm.streams.operations.aggregate","outputs":[{"id":"target","schema_ref":"schema7","links":[{"node_id_ref":"objectstorage_v2_ddluozcs76k","port_id_ref":"source"}]}],"parameters":{"window_type":"sliding","window_time_unit":"minute","window_number_of_time_units":"5","use_timestamp_in_tuple":true,"timestamp_field":"time_stamp","partition_by":"product_category","group_by":"","aggregation_output":[{"name":"time_stamp","value":{"function":"Any","type":"timestamp","arguments":["time_stamp"]},"type":""},{"name":"product_category","value":{"function":"Any","type":"varchar","arguments":["product_category"]},"type":""},{"name":"total_sales_last_5min","value":{"function":"Sum","type":"double","arguments":["product_price"]},"type":""}],"schema_mapping":[{"name":"time_stamp","type":"timestamp"},{"name":"product_category","type":"string"},{"name":"total_sales_last_5min","type":"double"}]},"app_data":{"ui_data":{"label":"5min_dept_sales","x_pos":-343,"y_pos":32}}},{"id":"objectstorage_v2_ddluozcs76k","type":"binding","op":"ibm.streams.targets.objectstorage_v2","parameters":{"header_row_enabled":true,"write_policy":"numberOfEvents","rolling_number_of_events":"100"},"connection":{"ref":"48f9e5ff-31cd-483c-8f41-83e5aa885037","project_ref":"e063a60f-efd2-4106-95a3-9efb18692908","properties":{"asset":{"path":"/aggregatedemo/5min_dept_sales.csv","asset_types":[],"assets":[],"fields":[],"extended_metadata":[],"first":{"href":"https://api.dataplatform.ibm.com/v2/connections/48f9e5ff-31cd-483c-8f41-83e5aa885037/assets?project_id=e063a60f-efd2-4106-95a3-9efb18692908&offset=0&limit=100&path=%2Faggregatedemo%2F5min_dept_sales.csv"},"total_count":0,"logs":[]}}},"app_data":{"ui_data":{"label":"Cloud Object Storage","x_pos":-103,"y_pos":32}}}]}],"schemas":[{"id":"schema0","fields":[{"name":"customer_id","type":"double"},{"name":"time_stamp","type":"timestamp"},{"name":"click_event_type","type":"string"},{"name":"total_price_of_basket","type":"double"},{"name":"total_number_of_items_in_basket","type":"double"},{"name":"total_number_of_distinct_items_in_basket","type":"double"},{"name":"product_name","type":"string"},{"name":"product_category","type":"string"},{"name":"product_price","type":"double"}]},{"id":"schema1","fields":[{"name":"time_stamp","type":"timestamp"},{"name":"total_customers_per_hr","type":"integer"}]},{"id":"schema2","fields":[{"name":"customer_id","type":"double"},{"name":"time_stamp","type":"timestamp"},{"name":"click_event_type","type":"string"},{"name":"total_price_of_basket","type":"double"},{"name":"total_number_of_items_in_basket","type":"double"},{"name":"total_number_of_distinct_items_in_basket","type":"double"},{"name":"product_name","type":"string"},{"name":"product_category","type":"string"},{"name":"product_price","type":"double"}]},{"id":"schema3","fields":[{"name":"time_stamp","type":"timestamp"},{"name":"total_sales_last_5min","type":"double"}]},{"id":"schema4","fields":[{"name":"customer_id","type":"double"},{"name":"time_stamp","type":"timestamp"},{"name":"click_event_type","type":"string"},{"name":"total_price_of_basket","type":"double"},{"name":"total_number_of_items_in_basket","type":"double"},{"name":"total_number_of_distinct_items_in_basket","type":"double"},{"name":"product_name","type":"string"},{"name":"product_category","type":"string"},{"name":"product_price","type":"double"}]},{"id":"schema5","fields":[{"name":"time_stamp","type":"timestamp"},{"name":"product_category","type":"string"},{"name":"total_sales_last_30min","type":"double"}]},{"id":"schema6","fields":[{"name":"time_stamp","type":"timestamp"},{"name":"product_category","type":"string"},{"name":"total_sales_last_10min","type":"double"}]},{"id":"schema7","fields":[{"name":"time_stamp","type":"timestamp"},{"name":"product_category","type":"string"},{"name":"total_sales_last_5min","type":"double"}]}]},"engines":{"streams":{"instance_id":"d99131f8-76e0-45e1-86de-c854979235d1"}}}}